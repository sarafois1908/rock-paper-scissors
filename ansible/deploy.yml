---
- name: deploy file .jar
  hosts: {{ project_name }}
  serial: 1

  tasks: 
    - name: get file in the target host
      get_url: 
        url:   http://172.29.16.32:8081/repository/{{ repo_name }}/{{ artifact_name }}
        dest: /temp/{{ artifact_name }}
        mode: '0777'
        url_password: password
        url_username: admin
    
    - name: deploy file
      shell: 
        chdir: /temp/
        cmd: echo "webappct deploy {{ project_name }} {{ artifact_name }}" > /temp/output

    - name: remove downloaded file
      file: 
        path: /temp/{{ artifact_name }}
        state: absent

    - name: check site up
        uri: 
          url: "http://192.0.2.1/some/test"
          follow_redirects: all
          method: GET
      register: _result
      until: _result.status == 200
      retries: 60  # 60 * 2 seconds = 2minutes 
      delay: 2 # Every 2 second